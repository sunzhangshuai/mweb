# 索引类型
## 主键索引
也叫聚簇索引【clustered index】
叶子节点存储的是整行数据

## 非主键索引
也叫二级索引【secondary index】
叶子节点的内容是主键的值

### 普通索引
- 使用场景：提高归档效率。业务已限制唯一性。
- 查询过程：
    1. 查找到第一个满足条件的记录后停止。
    2. 将查询结果载入内存。
    3. 如果有数据页相关的change buffer，与change buffer 进行merge后更新内存。
- 更新过程：
    - 记录要更新的目标页在内存中：直接更新内存
    - 记录要更新的目标页不在内存中：将更新操作记录在change buffer中，更新结束
    
### 唯一索引
- 使用场景：需要通过数据库来保证唯一性
- 查询过程：查找到第一个满足条件的记录后停止
- 更新过程：
    - 记录要更新的目标页在内存中：先判断是否冲突，没有冲突，直接更新内存
    - 记录要更新的目标页不在内存中：从磁盘中读入数据页，判断冲突，不冲突更新内存

### 字符串索引

索引类型 | 使用注意事项 | 优点 | 缺点
:-- | :-- | :-- | :--
完整索引 | | 扫描行数少 | 占用空间大 
前缀索引 | 创建方法：`index(field(len))`；通过`count(distinct left(field, len))`计算区分度来判断合适的前缀长度，区分度损失5%合理。 | 节省空间 | 增加扫描次数；影响覆盖索引
倒序索引 | 字符串倒存；适用于前缀区分度不高，后缀区分度高的情况。 | 增加索引区分度 | 不支持范围查询；reverse()消耗CPU，比crc32()消耗少；增加扫描次数；影响覆盖索引
hash索引 | 新增整数字段，用函数计算出校验码，对整数字段建索引；适用于前后区分度都不高的情况。 | 平均扫描行数接近1 | 不支持范围查询；crc32()多消耗CPU；额外占用空间；影响覆盖索引

