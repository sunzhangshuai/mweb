# 时间事件

## 定义
redis服务器中的一些操作需要在给定时间点执行，时间事件就是对这类定时操作的抽象。

## 类别
1. 定时事件：让一段程序在指定的时间之后执行一次。
2. 周期性事件：让一段程序每隔一段时间执行一次。

事件类型取决于事件处理器的返回值。
- AE_NOMORE：定时事件，倒达后将事件删除。
- 非AE_NOMORE的整数值：周期性事件，根据返回值对when进行更新。「目前只有周期性事件」

## 属性
1. id：服务器为时间事件创建的全局唯一ID，id按从小到大排列，新事件的id号比旧事件的id号大。
2. when：记录事件的到达时间。时间戳。
3. timeProc：时间事件处理器，一个函数。

## 实现
- 无序列表头插。
- 无序指不安when排序，仍然按照ID由大到小排序。
- 因此每次执行时间事件，需要从头到尾进行遍历。

## 实例：serverCron函数。
1. 更新服务器的各类统计信息，比如时间、内存占用、数据库占用时间。
2. 清理数据库中过期键值对。
3. 关闭和清理连接失败的客户端。
4. 尝试进行AOF或RDB持久化操作。
5. 如果服务器是主服务器，对服务器进行定期同步。
6. 如果处于集群模式，对集群进行定期同步和连接测试。
7. 默认每秒运行10次，可根据hz参数修改。
8. 一般情况下时间事件只执行serverCron函数。


