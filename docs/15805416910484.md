# MIPS

## MIPS 操作数
名字 | 示例 | 注释
:-- | :-- | :--
32个寄存器 | `$s0~$s7`,<br>`$t0~$t9`,<br>`$zero`,<br>`$a0~$a3`,<br>`$v0~$v1`,<br>`$gp`,<br>`$fp`,<br>`$sp`,<br>`$ra`,<br>`$at` | 寄存器用于数据的快速存取，在MIPS中，只能对存放在寄存器中的数据执行算术操作，寄存器`$zero`的值恒为0，寄存器`$at`被汇编器保留，用于处理大的常数。
2³⁰个存储器字 | Memory[0],<br>Memory[4],<br>...<br>Memory[4294967292] | 存储器只能通过数据传输指令访问，MIPS使用字节编码，所以连续的的字地址相差4，存储器用于保存数据结构、数组和溢出的寄存器

### 寄存器
名称 | 寄存器号 | 用途 | 调用时是否保存
:-: | :-: | :-- | :-:
`$zero` | 0 | 常数0 | 不适用
`$at` | 
`$v0 ~ $v1` | 2 ~ 3 | 计算结果和表达式求值 | 否 
`$a0 ~ $a3` | 4 ~ 7 | 参数 | 否
`$t0 ~ $t7` | 8 ~ 15 | 临时变量，用作被调用者可以方便使用的寄存器 | 否
`$s0 ~ $s7` | 16 ~ 23 | 保存的寄存器 | 是
`$t8 ~ $t9` | 24 ~ 25 | 更多临时变量 | 否
`$gp` | 28 | 全局指针 | 是
`$sp` | 29 | 栈指针 | 是
`$fp` | 30 | 帧指针 | 是
`$ra` | 31 | 返回地址 | 是

## MIPS汇编语言

### 算术
指令 | 示例 | 含义 | 注释
:-- | :-- | :-- | :--
加法 | `add $s1,$s2,$s3` | `$s1 = $s2 + $s3` | 三个寄存器操作数
减法 | `sub $s1,$s2,$s3` | `$s1 = $s2 - $s3` | 三个寄存器操作数
立即数加法 | `addi $s1,$s2,20` | `$s1 = $s2 + 20` | 用于加常数数据

### 数据传输 
指令 | 示例 | 含义 | 注释
:-- | :-- | :-- | :--
取字 | `lw $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 将一个字从内存中取到寄存器中
存字 | `sw $s1,20($s2)` | `Memory[$s2 + 20] = $s1` | 将一个字从寄存器中取到内存中
取半字 | `lh $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 将一、半个字从内存中取到寄存器中
取无符号半字 | `lhu $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 将半个字从内存中取到寄存器中
存半字 | `sh $s1,20($s2)` | `Memory[$s2 + 20] = $s1` | 将半个字从寄存器中取到内存中
取字节 | `lb $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 将一个字节从内存中取到寄存器中
取无符号字节 | `lbu $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 将一个字节从内存中取到寄存器中
存字节 | `sb $s1,20($s2)` | `Memory[$s2 + 20] = $s1` | 将一个字节从寄存器存到内存中
取链接字 | `ii $s1,20($s2)` | `$s1 = Memory[$s2 + 20]` | 取字作为交换的前半部
存条件字 | `sc $s1,20($s2)` | `Memory[$s2 + 20] = $s1;$s1 = 0 or 1` | 存字作为原子交换的后半部分
取立即数的高位 | `lui $s1,20` | `$s1 = 20 * 2¹⁶` | 取立即数并放到高16位

### 逻辑
指令 | 示例 | 含义 | 注释
:-- | :-- | :-- | :--
与 | `and $s1,$s2,$3` | `$s1 = $s2 & $s3` | 三个寄存器操作数按位与
或 | `or $s1,$s2,$3` | `$s1 = $s2 | $s3` | 三个寄存器操作数按位或
或非 | `nor $s1,$s2,$3` | `$s1 = ~($s2 | $s3)` | 三个寄存器操作数按位或非
立即数与 | `addi $s1,$s2,20` | `$s1 = $s2 & 20` | 和常数按位与
立即数或 | `ori $s1,$s2,20` | `$s1 = $s2 | 20` | 和常数按位或
逻辑左移 | `sll $s1,$s2,10` | `$s1 = $s2 << 10` | 根据常数左移相应位
逻辑右移 | `srl $s1,$s2,10` | `$s1 = $s2 >> 10` | 根据常数右移相应位

### 条件分支
指令 | 示例 | 含义 | 注释
:-- | :-- | :-- | :--
相等时跳转 | `beq $s1,$s2,25` | `if ($s1 == $s2) go to PC+4+100` | 相等检测；和pc相关的跳转
不相等时跳转 | `bne $s1,$s2,25` | `if ($s1 != $s2) go to PC+4+100` | 不相等检测；和pc相关的跳转
小于时置位 | `slt $s1,$s2,$s3` | `if ($s2 < $s3) $s1 = 1 else $s1 = 0` | 比较是否小于；beq,bne
无符号数比较小于时置位 | `sltu $s1,$s2,$s3` | `if ($s2 < $s3) $s1 = 1 else $s1 = 0` | 比较是否小于无符号数
无符号数比较小于立即数时置位 | `slti $s1,$s2,20` | `if ($s2 < 20) $s1 = 1 else $s1 = 0` | 比较是否小于常数
无符号数比较小于无符号立即数时置位 | `sltiu $s1,$s2,20` | `if ($s2 < 20) $s1 = 1 else $s1 = 0` | 比较是否小于无符号常数

### 无条件跳转
指令 | 示例 | 含义 | 注释
:-- | :-- | :-- | :--
跳转 | `j 2500` | `go to 10000` | 跳转到目标地址
跳转至寄存器所指位置| `jr $ra` | `go to $ra `| 用于switch语句，以及过程调用
跳转并链接 | `jal 2500` | `$ra = PC + 4；go to 10000` | 用于过程调用

## 指令位数
32位

## 指令格式

### R型 （算术指令型）
op  | rs | rt | rd | shamt | funct 
:-: | :-: | :-: | :-: | :-: | :-:
6位 | 5位 | 5位 | 5位 | 5位 | 6位
操作码 | 第一个源操作数寄存器 | 第二个源操作数寄存器 | 用于存放操作结果的目的寄存器 | 位移量 | 功能码，用于指明op字段中操作的特定变式

### I型 （传输、分支和立即数型）
op | rs | rt | constant or address
:-: | :-: | :-: | :-:
6位 | 5位 | 5位 | 16位
操作码 | 源操作数基址寄存器 | 接收取数结果的目的寄存器 | 立即数

### J型 （跳转指令型）
op | address
:-: | :-:
6位 | 26位
操作码 | 地址

## MIPS指令解码

### op操作码
后三位<br>前三位 | 0(000) | 1(001) | 2(010) | 3(011) | 4(100) | 5(101) | 6(110) | 7(111)
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
0(000) | R型 | Bltz/gez | 跳转 | 跳转并链接 | 分支eq | 分支ne | blez | bgtz
1(001) | 立即数加法 | addiu | 小于立即数置位 | 小于无符号立即数时置位 | andi | ori | xori | 取立即数高位
2(010) | TLB | FIPT
3(011) | 
4(100) | 取字节 | 取半字 | lwl | 取字 | 取无符号字节 | 取无符号半字 | lwr
5(101) | 存字节 | 存半字 | swl | 存字 | | | swr
6(110) | 取链接字 | lwcl
7(111) | 存条件字 | swcl

### op=010000(TLB)，rs
后三位<br>两三位 | 0(000) | 1(001) | 2(010) | 3(011) | 4(100) | 5(101) | 6(110) | 7(111)
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
0(00) | mfc0 |  | cfc0 | | mtc0 | | ctc0 |
1(01) |
2(10) |
3(11) |

### op=000000(R型)，funct
后三位<br>前三位 | 0(000) | 1(001) | 2(010) | 3(011) | 4(100) | 5(101) | 6(110) | 7(111)
:-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-:
0(000) | 逻辑左移 | | 逻辑右移 | sra | sllv | | srlv | srav
1(001) | jump register | jalr | | | syscall | break
2(010) | mfhi | mthi | mflo | mtlo
3(011) | mult | multu | div | divu
4(100) | add | addu | subtract | subu | and | or | xor | not or(nor)
5(101) | | | set I.t. | set I.t. 无符号操作
6(110) | 
7(111) | 



