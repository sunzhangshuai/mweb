# 40分钟课改

- 项目总负责

## 工作内容

## 背景
2019-07-12，教育部要求线上培训时长不能超过40分钟。需要对现有订单剩余的课程进行折算，上课由原来45、60共存统一改为40分钟。

## 难点
1. 底层数据结构无法支撑这次改动，所以需要重新设计。
2. 代码老旧，原始数据一直存在不准的问题，跨服务下极难排查，顽留近一年。粗糙转换会导致错上加错，需要先做数据修复。
3. 旧接口的数据的结构性和定义比较错乱，除了需要内部重构，对外接口暴露格式也要有大量改动。
4. 涉及发放金额的调整，全面停服上线，开发压力大，出错代价高。
5. 涉及平台广，平台涉及学生客户端、教师客户端、学习管理系统、师资管理系统多平台的改动。
6. 开发参与人员多，沟通比较紧密。其中我直接负责底层服务团队和师资团队7人，C端研发3人，前端4人。
7. 时间紧、任务重。从开始开发到上线共一个月时间。

## 工作职责
1. 把控项目整体进度，分配开发任务，保证项目按期无误上线。
2. 设计底层数据结构，切分模块。搭建能直接落地开发的整体代码结构。
3. 历史争议课程需要按规则全部处理干净。
4. 负责修复旧数据，用修复后的清洗成新的结构。
5. 负责模块开发、各段对接。
6. 对新数据的持续验准和监测脚本开发。

## 遇到的问题
1. 修复和清洗涉及全部的课程和账户相关数据，需要全体计算和移动的数据量超5000W。通过多线程的设计加快清洗速度。
2. 上线后，遇到高并发下发生的重复排课问题。经过迅速排查，最终确定为死锁问题。极快响应解决。

## 绩效
1. 完全解决之前线上频发的数据不准问题，至今没有新的问题产生。
2. 通过多种设计模式重构后的代码结构清晰，调理分明，扩展点的设计也比较充分。代码质量可以坚持较长时间。
3. 该项目获得7月最佳项目奖。项目意义重大。